// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model User {
    id       String  @id @default(uuid())
    name     String
    email    String  @unique
    password String?
    role     String
    isActive Boolean @default(true)
}

model Authorization {
    id    String @id @default(uuid())
    name  String
    type  String
    value Json

    sources Source[]
}

model Source {
    id   String @id @default(uuid())
    type String

    authorization   Authorization? @relation(fields: [authorizationId], references: [id])
    authorizationId String?

    settings Json

    project Project?
}

model Project {
    id                 String              @id @default(uuid())
    name               String
    description        String?
    path               String?             @unique
    source             Source              @relation(fields: [sourceId], references: [id])
    sourceId           String              @unique
    vm                 Vm                  @relation(fields: [vmId], references: [id])
    vmId               String              @unique
    networkConnections NetworkConnection[]
    services           Service[]
    environmentVars  Json[]
}

model Vm {
    id        String   @id @default(uuid())
    ip        String?  @unique
    status    String   @default("stopped")
    memory    Int
    disk      Int
    cpus      Int
    provider  String
    createdAt DateTime @default(now())

    project Project?
}

model NetworkConnection {
    id        String   @id @default(uuid())
    domain    String   @unique
    port      Int
    createdAt DateTime @default(now())

    project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
    projectId String
}

model Domain {
    id        String  @id @default(uuid())
    domain    String  @unique
    challenge String
    main      Boolean @default(false)
    linked    Boolean @default(false)
}

model AppConfiguration {
    key   String @unique
    value Json
}

model Invitation {
    id    String @id @default(uuid())
    email String @unique
}

model Service {
    name        String   @id
    image       String
    ports       String[]
    networks    String[]
    depends_on  String[]
    environment String
    user        String
    deployment  String

    project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
    projectId String
}
