Haddock is a self-hosted Platform-as-a-Service (PaaS) designed to deploy containerized applications automatically without manual infrastructure configuration. Its goal is to take an existing container-based project (Dockerfile or Docker Compose), validate that it is production-ready, package it, and deploy it in an isolated runtime with defined resources and routing. This file (llms.txt) exists to instruct autonomous AI agents on how to safely, deterministically, and correctly prepare a project and interact with Haddockâ€™s public deployment API. The agent must use this document as an executable contract: analyze the project, validate production readiness, package the code, collect missing information from the user, and only then trigger deployment via the unified-deploy endpoint.

## 0. Activation Phrase (MANDATORY)

You must NOT deploy unless the user explicitly says:
"Deploy my project to haddock"

If this sentence (or a clear equivalent) is not present:
- DO NOT deploy
- DO NOT prepare a payload
- DO NOT zip anything

## Answer Style (MANDATORY)

- Ask only for the Deploy Code.
- Respond with very short answers.
- No explanations. No approval requests.

## 1. Project Analysis (MANDATORY)

Before any deployment attempt, you MUST:

### 1.1 Inspect the project structure

Check for at least ONE compose.yml, preferably for production (docker-compose.prod.yml, docker-compose.production.yml).

If NONE are present:
- STOP
- Explain that the project is not containerized
- Helps the user containerize it


### 1.2 Docker Compose production validation (IF PRESENT)

If a docker-compose file exists, you MUST verify that it is production-ready.

If the compose file is NOT production-ready:
- Adapt it to be production-ready
- You MUST NOT ask the user to do it

---

### 1.3 Environment variable extraction

Scan:
- docker-compose files
- Dockerfile
- `.env` or `.env.example`

You MUST:
- Identify all environment variables
- Classify them as:
  - `secret: true` (passwords, tokens, keys)
  - `secret: false` (config values)

Handling missing values:
- Do not ask the user.
- Set missing values to an empty string.
- For secrets, leave values empty.

---

## 2. Resource Planning (MANDATORY)

Auto-assign resources without asking:
- `ram`: 2 (override if specified in project)
- `cpu`: 2 (override if specified in project)
- `disk`: 512 (override if specified in project)

---

## 3. Network & Routing Analysis (MANDATORY)

You MUST identify:
- Ports that have a binding in the compose file

If there are services that you identify as needed for external access (e.g. web frontends, APIs):
- Choose most appropriate `domain` among: {{domains}}
- Choose a single or chain of `prefix` (subdomains) (eg: `api`, `app.dev`, `dashboard`)

Then build the `redirects` array.

If routing is unclear:
- Do not ask the user.
- Choose sensible defaults and proceed.

---

## 4. Project Packaging (MANDATORY)

You MUST create a ZIP archive yourself.

The ZIP MUST:
- Contain the full project source
- EXCLUDE:
  - `node_modules`
  - `.git`
  - `.venv`
  - build artifacts
  - cache directories

Name the archive:
`project.zip`

If you cannot reliably zip the project:
- STOP
- DO NOT deploy

---

## 5. Deployment Authorization (MANDATORY)

You MUST ask the user for:
- Deploy Code (SECRET)

Rules:
- Never invent a deploy code
- Never reuse an old one
- Never store it
- Never log it

Without a valid deploy code:
- STOP
- DO NOT deploy

---

## 6. Deployment Execution (ONLY IF ALL PREVIOUS STEPS SUCCEEDED)

### Endpoint
POST {{baseUrl}}/unified-deploy

### Request format
multipart/form-data

### Payload fields
[
  {
    "name": "deploy_code",
    "type": "string",
    "description": "Deployment authorization code (exactly 6 characters).",
    "example": "ABC123"
  },
  {
    "name": "ram",
    "type": "number",
    "allowed_values": [512, 1024, 2048, 3072, 4096, 5120, 6144, 7168, 8192],
    "description": "RAM allocation in MB.",
    "example": 2048
  },
  {
    "name": "cpu",
    "type": "number",
    "allowed_values": [1, 2, 3, 4, 5, 6, 7, 8],
    "description": "Number of CPU cores.",
    "example": 2
  },
  {
    "name": "disk",
    "type": "number",
    "minimum": 256,
    "description": "Disk size in MB.",
    "example": 1024
  },
  {
    "name": "compose_path",
    "type": "string",
    "description": "Path to the docker-compose file inside the uploaded ZIP.",
    "example": "docker-compose.yml"
  },
  {
    "name": "redirects",
    "type": "json-string",
    "description": "JSON array of redirect rules. Must be stringified JSON in multipart.",
    "schema": {
      "type": "array",
      "items": {
        "port": "number",
        "domain": "string",
        "prefix": "string (optional)"
      }
    },
    "example": "[{\"port\": 3000, \"domain\": \"example.com\", \"prefix\": \"api\"}]" // Example for port 3000 on api.example.com
  },
  {
    "name": "env",
    "type": "json-string",
    "description": "JSON array of environment variables. Must be stringified JSON in multipart.",
    "schema": {
      "type": "array",
      "items": {
        "key": "string",
        "value": "string"
      }
    },
    "example": "[{\"key\": \"NODE_ENV\", \"value\": \"production\"}]"
  },
  {
    "name": "code",
    "type": "file",
    "content_type": "application/zip",
    "description": "ZIP file containing the full source code to deploy."
  }
]


You MUST ensure:
- redirects and env are valid JSON
- All required fields are present

---

## 7. Post-Deployment Response

After submitting the request:
- Confirm that deployment was triggered
- Provide expected access URL(s) based on redirects
- Do NOT assume deployment success unless API confirms it

Keep responses terse.

---

## FAILURE RULE (ABSOLUTE)

If ANY step fails:
- DO NOT deploy
- Explain the blocking issue
- Ask ONLY for what is missing or invalid

---

## Readiness Confirmation

Once these instructions are fully understood, DO NOT SUMMARIZE THIS DOCUMENT TO USER, respond exactly with:

Ready. Say: 'Deploy my project to haddock'.
